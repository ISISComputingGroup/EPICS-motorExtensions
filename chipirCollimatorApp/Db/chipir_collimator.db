
### CHIPIR Collimator

## User variables
# User facing
record(ao, "$(P)TARGET_POS:SP") {
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(OUT, "@asyn(Galil,0)USER_VAR targ_pos")
    field(FLNK, "$(P)MOVE:CMD")
    field(LOPR, 0)
    field(HOPR, 6)
    field(EGU, "")
}

record(ai, "$(P)TARGET_POS:SP:RBV") {
    field(SCAN, "1 second")
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(INP, "@asyn(Galil,0)USER_VAR targ_pos")
    field(PREC, "1")
    field(EGU, "")
}

record(ai, "$(P)CURR_POS") {
    field(SCAN, "1 second")
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR curr_pos")
}

record(ai, "$(P)PREV_POS") {
    field(SCAN, "1 second")
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR prev_pos")
}

record(ai, "$(P)TARGET_SWITCH") {
    field(SCAN, "1 second")
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR targ_sw")
}

record(ai, "$(P)MODE") {
    field(SCAN,"1 second")
    field(DTYP,"asynFloat64")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR mode")
}


record(ai, "$(P)_POSN_POS") {
    field(SCAN,"1 second")
    field(DTYP,"asynFloat64")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR posn_pos")
}

record(ai, "$(P)_POSN_NEG") {
    field(SCAN,"1 second")
    field(DTYP,"asynFloat64")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR posn_neg")
}

record(ai, "$(P)_TARGET_DIRECTION") {
    field(SCAN, "1 second")
    field(DTYP, "asynFloat64")
    field(PREC, "1")
    field(EGU, "")
    field(INP, "@asyn(Galil,0)USER_VAR targ_dir")
}


## execution
record(scalcout, "$(P)MOVE:CMD") {
    field(AA, "$(MOVE_THREAD=3)")
    field(BB, "XQ #MOVE,")
    field(CALC, "BB+AA")
    field(OUT, "$(SEND_CMD) PP")
}

record(scalcout, "$(P)HOME:CMD") {
    field(AA, "$(HOME_THREAD=2)")
    field(BB, "XQ #HOME_SW,")
    field(CALC, "BB+AA")
    field(OUT, "$(SEND_CMD) PP")
}

record(scalcout, "$(P)READ_PINI") {
    field(AA, "$(READ_THREAD=7)")
    field(BB, "XQ #READ,")
    field(CALC, "BB+AA")
    field(OUT, "$(SEND_CMD) PP")
	field(PINI, "YES")
}
